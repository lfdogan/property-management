//THIS IS A SERVICE SO IT SHOULD BE USED FOR ALL CODE THAT WILL BE USED ON MULTIPLE TEMPLATES



(function() {
    function Bills($firebaseArray) {//Inject dependencies and the additional services into the this service. B

        // Firebase database references
        var rootRef = new Firebase("https://property-management-lfdogan.firebaseio.com/");
        var billsRef = rootRef.child('bills');
        
        
            //get all bills from database
            //'all' is ordered by default (index)
            //in the controller Messages is renamed allMessages and html ng-repeat calls allMessages        
        var Bills = {
            billNumber: function() {
                return $firebaseArray(billsRef.orderByChild("billNumber")); //order tasks by unique key (also dateAdded)
            }
        };
        
        
         /****************/
         
         
         
         
         var billNumber = document.getElementById('billNumber'); 
         var building = document.getElementById('building'); 
         var account = document.getElementById('account');
         var description = document.getElementById('description');
         var cost = document.getElementById('cost');     
         
         var btnBillUpdate = document.getElementById('btnBillUpdate'); //update button for new bill
    
         
         

         
         //when user clicks on update button... save to firebase:
         //.set() replaces previous value of 'currentMessage' child with new value from input box
         //.push() adds a new unique key and new value to 'allMessages' child. Generate a reference to a new location and add some data using push(). Calling push() will return a reference to the new data path, which you can use to get the value of its ID or set data to it. 
         // Get the unique ID generated by push(). Calling key() on our push() reference gives us the value of the unique ID.
         // Clear out value of input textbox to empty to prepare for next entry     
         var postID;
         var newPostRef;
         btnBillUpdate.addEventListener('click', function(){
             console.log("UPDATE");
             newPostRef = billsRef.push();
             newPostRef.set({
                 billNumber: billNumber.value, //entered by user
                 //building: building.value, //entered by user
                 building: "2165 54th St",
                 status: "Paid",
                 account: account.value, //entered by user
                 description: description.value, //entered by user
                 cost: cost.value, //entered by user
                 billDate: Firebase.ServerValue.TIMESTAMP // record the time when task was entered
             });
             postID = newPostRef.key();
             billNumber.value = '';
             building.value = '';
             account.value = '';
             description.value = '';
             cost.value = '';
         });
         
         
         
         /******************/
              
        
        return Bills;
        

        
        
        
/*************************************************************************************/
    }
    
    angular
        .module('propertyManagement')
        .factory('Bills', Bills);
})();